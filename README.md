# ESE Server

This repo contains the code to run the BE server that will publish the events generated by the FE to our Kafka pipeline. It internally uses redis as a temporary data store with an expiry of 5 minutes.

Connecting redis here is meant to serve as an example of how a dummy service can leverage it alongside a streaming pipleine for their customized usecase.

A combination of Grafana and Prometheus has been used to publish the metrics of our service and observe its performance.

- **Language** : [Go](https://go.dev/doc/)
- **HTTP Framework** : [Gin](https://gin-gonic.com/docs/)
- **Database** : [Redis](https://redis.io/docs/connect/clients/go/), [Prometheus (time-series)](https://prometheus.io/docs/prometheus/latest/getting_started/)
- **Observability** : [Grafana](https://grafana.com/docs/grafana/latest/)

---

## Running Locally

```bash
# This will start redis locally on mac on localhost:6379. Make sure to change your settings accordingly in the config.yaml file
brew services start redis

# Move to the working folder
cd src

# Install the required dependencies
go get .

# Specify the port on which you want the application to run
SERVER_PORT=2000 go run .
```

**Note :** In order to get the metrics, start your prometheus and grafana server seperately.

---

## Running via Docker (Recommended)

Running the following command will download all the required images, create a network for them to communicate and run 2 instances of the application on `localhost:2001` and `localhost:2002`

```bash
docker-compose up -d
```

**Postman Collection** : [JSON File](./files/Postman%20Collection.json)

---

## Connecting to Grafana

Log in to the local Grafana dashboard using the following credentials. The dashboard is hosted at `http://localhost:3000`

**Username :** admin

**Password :** admin

Import [this](./files/ESE%20Server%20Grafana%20Dashboard.json) file to set up the dashboard. When prompted to provide a data source, connect to the
**Prometheus Datasource URL :** `http://prometheus-server:9090`

---

## Exposing Server to your local network

If on Linux or Mac, run the following command to get the IP of the machine on which your Gin server is running

```bash
ifconfig | grep netmask
```

- Make sure the device that the server is running and the machine you want to connect to is on the same network.
- Get the broadcast IP address that is returned as a result of the above query.
- `<ip address>:2000` is where your device could connect to access the Gin server.

---

## Pushing Image

If you have made changes to the application, publish a new image with the following commands:

[DockerHub Repository](https://hub.docker.com/repository/docker/saumyabhatt10642/ese-server/general)

```bash
docker image build -t ese-server:tag .
docker image tag ese-server:tag saumyabhatt10642/ese-server:tag
docker push saumyabhatt10642/ese-server:tag
```
